---
title: 游戏角色序列帧图集资源加载类
date: 2024-10-14
updated: 2024-10-14
permalink: articles/Zhong classmate/项目1-提瓦特幸存者/
categories: Zhong classmate
tags: [项目总结]
---

# 游戏角色序列帧图集资源加载类

## `Atlas`序列帧图集类设计

为了方便图片资源管理与资源的可复用性，将具有相关性的一系列图片资源放入同一个容器当中统一管理

### 基础封装

若序列帧图集的命名有规律可以如下封装方式

````c++
#include <vector>
#include <tchar.h>
#include <graphics.h>
#include <string>
#include <vector>
class Atlas
{
public:
	std::vector<IMAGE*> frame_list;

public:
    //path:该路径下文件资源的文件名称有规律
    //path：图片相对地址/图片名前缀+ （字符串）'%d' + （字符串）'.png'
    //num：该图集内图片数量
	Atlas(LPCTSTR path, int num)
	{
		TCHAR path_file[256];
		for (size_t i = 0; i < num; i++)
		{
			_stprintf_s(path_file, _countof(path_file), path, i); // 生成具体序列帧图片的文件路径
			IMAGE* frame = new IMAGE();//声明图片临时变量
			loadimage(frame, path_file);//加载图片
			frame_list.push_back(frame);//加入序列帧图集列表
		}
	}

	~Atlas()
	{
		for (size_t i = 0; i < frame_list.size(); i++)
			delete frame_list[i];
	}

};
````

### 类的实例化

````c++
Atlas* atlas_player_left=new Atlas(
_T("img/player_left_%d.png"),6
);
//Atlas(LPCTSTR path, int num)
//path填_T(" 图片相对地址/图片名前缀+ 字符串'%d' + 字符串'.png'   ")，即图片序列帧通用路径的模板
//num:序列帧数量
````







## 拓展知识—`_countof`用法

`_countof` 是一个用于计算数组中元素个数的宏。它的作用是返回一个**数组**的元素总数，而不是它占用的字节数。这个宏在 C/C++ 中非常实用，特别是在处理定长数组时，确保你不会超出数组的边界访问。

### 定义
`_countof` 宏的工作原理是通过除以数组的单个元素的大小来获取数组的总元素数。它的定义如下：

```cpp
#define _countof(array) (sizeof(array) / sizeof(array[0]))
```

### 工作原理
1. `sizeof(array)`：返回整个数组的大小（以字节为单位）。
2. `sizeof(array[0])`：返回数组中第一个元素的大小（也是以字节为单位）。
3. `sizeof(array) / sizeof(array[0])`：将整个数组的大小除以单个元素的大小，得到数组的总元素个数。

### 使用场景
`_countof` 通常用于处理**定长数组**。这是因为在动态分配的数组中，数组名只是一个指针，不再包含数组大小信息。因此，`_countof` 只能用于编译时确定大小的数组，而不能用于指针。

### 例子

```cpp
TCHAR path_file[256];  // 这是一个包含 256 个元素的数组

// 使用 _countof 来获取 path_file 数组中的元素个数
size_t length = _countof(path_file);  // length 将等于 256
```

这个宏在函数中非常有用，特别是在需要传递数组大小的场合。例如：

```cpp
void myFunction(TCHAR* array, size_t size)
{
    // 做一些操作
}

int main()
{
    TCHAR path_file[256];
    
    myFunction(path_file, _countof(path_file));  // 将数组大小传递给函数
}
```

### 注意事项
1. **只能用于数组**：`_countof` 只能用于定长的静态数组，不能用于动态分配的内存块或指针。例如：

   ```cpp
   int* ptr = new int[10];
   size_t size = _countof(ptr);  // 错误！ptr 是指针，不是数组
   ```

   在这种情况下，`sizeof(ptr)` 返回的是指针本身的大小，而不是数组的大小。

2. **指针与数组的区别**：在 C++ 中，数组名（如 `path_file`）和指针在某些场合会被混淆。数组名是指向数组首元素的地址，但数组本身还包含了大小的信息，而指针只是一块内存地址，没有数组大小信息。

### 总结
- `_countof` 是一个非常有用的宏，可以用来获取定长数组中的元素个数。
- 它通过 `sizeof` 计算整个数组大小与单个元素大小的比值来得出数组的长度。
- `_countof` 只能用于静态数组，不能用于指针。





代码参考：Voidmatrix、C++文档

项目教程：【【从零开始的C++游戏开发】全宇宙最简单的类吸血鬼幸存者游戏开发 | EasyX制作提瓦特幸存者】https://www.bilibili.com/video/BV1eM4m1S74K?vd_source=3a9720f4e51b97861a15c946ae6f0c2d

文档错误请联系QQ1210965642
